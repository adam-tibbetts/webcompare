<head>
    <script src="node_modules/xel/xel.js" type="module"></script>
    <meta name="xel-theme" content="node_modules/xel/themes/adwaita.css" />
    <meta name="xel-accent-color" content="green" />
</head>
<section>
    <h1>WebCompare pre-alpha</h1>
    <h2>Settings</h2>
    <button id="select-directory">Select Directory</button>
    <form id="settings-form">
        <h4>Site URL</h4>
        <input type="text" id="baseUrl" value="https://seoplus.com/" />
        <h4>Crawl depth</h4>
        <input type="number" id="depth" value="1" min="0" />
        <input type="button" id="generateUrlListButton" value="Generate URL List" />
        <input
            type="submit"
            id="startCrawlButton"
            value="Start Crawling"
            disabled
        />
    </form>
    
    <h2>URLs to be crawled</h2>
    <ul id="url-list"></ul>
    
    <h2>Screenshots Taken</h2>
    <ul id="screenshot-list"></ul>
    
    <h2>Screenshots</h2>
    <div id="images"></div>
</section>


<script>
    const { ipcRenderer } = require("electron");

    document
        .getElementById("generateUrlListButton")
        .addEventListener("click", () => {
            const settings = {
                baseUrl: document.getElementById("baseUrl").value,
                depth: document.getElementById("depth").value,
                directory: window.selectedDirectory,
            };

            ipcRenderer.send("generate-url-list", settings);
        });

    document
        .getElementById("settings-form")
        .addEventListener("submit", (event) => {
            event.preventDefault();

            const settings = {
                baseUrl: document.getElementById("baseUrl").value,
                directory: window.selectedDirectory,
            };

            const urlList = Array.from(
                document.querySelectorAll("#url-list li")
            ).map((li) => li.textContent);

            ipcRenderer.send("start-crawl", settings, urlList);
        });

    ipcRenderer.on("screenshot-saved", (event, screenshotPath) => {
        const list = document.getElementById("screenshot-list");
        const listItem = document.createElement("li");
        listItem.textContent = `Screenshot saved at ${screenshotPath}`;
        list.appendChild(listItem);
    });

    document
        .getElementById("select-directory")
        .addEventListener("click", () => {
            ipcRenderer.send("select-directory");
        });

    ipcRenderer.on("directory-selected", (event, directory) => {
        window.selectedDirectory = directory;
    });

    ipcRenderer.on("url-list-generated", (event, urlList) => {
        const list = document.getElementById("url-list");
        list.innerHTML = urlList.map((url) => `<li>${url}</li>`).join("");

        document.getElementById("startCrawlButton").disabled = false;
    });
</script>

<script type="module">
    import { fs } from "electron";

    // Add this function to display images in the selected directory
    async function displayImages(directoryPath) {
        const files = await fs.promises.readdir(directoryPath);

        for (const file of files) {
            if (!file.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)) continue; // Skip non-image files

            const imgElement = document.createElement("img");
            imgElement.src = path.join(directoryPath, file);
            document.getElementById("images").appendChild(imgElement);
        }
    }

    ipcRenderer.on("directory-selected", (event, directory) => {
        window.selectedDirectory = directory;

        // Call displayImages when a directory is selected
        displayImages(directory).catch((error) =>
            console.log("Error displaying images:", error)
        );
    });
</script>
